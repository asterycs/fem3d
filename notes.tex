\documentclass[a4paper]{article}	   

\usepackage[table,xcdraw]{xcolor}	   
\usepackage{amsmath,amsfonts,amssymb}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}  
\usepackage{parskip}     
\usepackage{graphicx}      
\usepackage{epstopdf}   
\usepackage{placeins} 
\usepackage{caption}
\usepackage{titling}
\usepackage{gensymb}
\usepackage{dsfont}
\usepackage{multirow}
\usepackage[final]{pdfpages}
\usepackage{fullpage}
\usepackage{mathtools}
\usepackage{booktabs}
\usepackage{enumerate}
\usepackage{listings}
\usepackage{subcaption}
\definecolor{mygreen}{RGB}{28,172,0} % color values Red, Green, Blue
\definecolor{mylilas}{RGB}{170,55,241}
\lstset{language=Matlab,
    %basicstyle=\color{red},
    breaklines=true,
    morekeywords={matlab2tikz},
    keywordstyle=\color{blue},
    morekeywords=[2]{1}, keywordstyle=[2]{\color{black}},
    identifierstyle=\color{black},
    stringstyle=\color{mylilas},
    commentstyle=\color{mygreen},
    showstringspaces=false,
    numbers=left,
    numberstyle={\tiny \color{black}},
    numbersep=9pt,
    emph=[1]{for,end,break},emphstyle=[1]\color{red},
    %emph=[2]{word1,word2}, emphstyle=[2]{style},    
}


\renewcommand{\vec}[1]{\mathbf{#1}}
\DeclareMathOperator{\sgn}{sgn}

\newcommand{\subtitle}[1]{%
  \posttitle{%
    \par\end{center}
    \begin{center}\large#1\end{center}
    \vskip2em}
}

\begin{document}
\title{Memoirs}
\subtitle{Finite element project}
\maketitle

\section*{Description}

The code supports FEM problems of the form
\begin{align*}
(\nabla u,\nabla v) &= (f,v) \\
u_i &= 0,\ \text{for some i}.
\end{align*}
Mathematical treatment of this type of problems is covered in the lecture notes and are thus omitted here.
The goal is to also support nonlinear problems of the form
\begin{align*}
\underbrace{(a(\|\nabla u\|_2^2)\nabla u,\nabla v)}_{G(u,v)} &= \underbrace{(f,v)}_{L(v)} \\
u_i &= 0,\ \text{for some i}.
\end{align*}
The behavior of the l.h.s is dependent of the solution, and no closed form solution exists. We aim to solve this problem using the Newton-Raphson method
\begin{align*}
u_{k+1}=u_k-\gamma (\nabla\phi(u_k))^{-1}\phi(u_k)=u_k-\gamma \varepsilon,
\end{align*}
where $\gamma$ is either a fixed damping parameters or solved using line search. Let $u_0$ be the initial guess. Then we assume there exists an $\epsilon$ s.t.
\begin{align*}
G(u_0+\varepsilon,v) = L(v).
\end{align*}
A linear approximation in $u_0$ of the l.h.s yields
\begin{align*}
G(u_0,v) +DG(u_0,v)(\varepsilon) = L(v) \\
DG(u_0,v)(\varepsilon) = L(v)-G(u_0,v). \\
\end{align*}
We introduce the Fréchet derivative of $DG(u_0,v)$:
\begin{align*}
DG(u_0,v)(\varepsilon) &= \lim_{h\rightarrow 0} \frac{ \left(a\left(\|\nabla (u_0+h\varepsilon)\|_2^2\right)\left(\nabla(u_0+h\varepsilon)\right),\nabla v\right) - \left(a\left(\|\nabla u_0\|_2^2\right) \nabla u_0 ,\nabla v\right)}{h} \\
&= \lim_{h\rightarrow 0} \frac{ \left(a\left(\|\nabla u_0+\nabla h\varepsilon\|_2^2\right)\left(\nabla u_0+h\nabla\varepsilon\right),\nabla v\right) - \left(a\left(\|\nabla u_0\|_2^2\right) \nabla u_0 ,\nabla v\right)}{h}
\end{align*}
Here we use $a(\|\nabla u_0+h\nabla \varepsilon\|_2^2)\approx a(\|\nabla u_0\|_2^2+2ha'(\|\nabla u_0\|_2^2)\cdot \nabla u_0^T\nabla \varepsilon$ and get
\begin{align*}
DG(u_0,v)(\varepsilon) &\approx \lim_{h\rightarrow 0} \frac{\left( (a\left(\|\nabla u_0 \|_2^2\right)+2ha'(\|\nabla u_0\|_2^2)\cdot \nabla u_0^T\nabla \varepsilon) \left(\nabla u_0+h\nabla \varepsilon\right),\nabla v\right) - \left(a\left(\|\nabla u_0\|_2^2\right) \nabla u_0 ,\nabla v\right)}{h} \\
%
&= \lim_{h\rightarrow 0} \Big(
\left( (a\left(\|\nabla u_0 \|_2^2\right)+2ha'(\|\nabla u_0\|_2^2)\cdot \nabla u_0^T\nabla \varepsilon) \nabla u_0,\nabla v\right) \\
&+\left( (a\left(\|\nabla u_0 \|_2^2\right)+2ha'(\|\nabla u_0\|_2^2)\cdot \nabla u_0^T\nabla \varepsilon) h\nabla \varepsilon,\nabla v\right) \\
&- \left(a\left(\|\nabla u_0\|_2^2\right) \nabla u_0 ,\nabla v\right)
\Big)h^{-1} \\
%
&= \lim_{h\rightarrow 0} \Big(
\left( a\left(\|\nabla u_0 \|_2^2\right) \nabla u_0,\nabla v\right)
+\left( 2ha'(\|\nabla u_0\|_2^2)\cdot \nabla u_0^T\nabla \varepsilon \nabla u_0,\nabla v\right) \\
&+\left( a\left(\|\nabla u_0 \|_2^2\right) h\nabla \varepsilon,\nabla v\right) 
+\left( 2ha'(\|\nabla u_0\|_2^2)\cdot \nabla u_0^T\nabla \varepsilon \cdot h\nabla\varepsilon,\nabla v\right) \\
&- \left(a\left(\|\nabla u_0\|_2^2\right) \nabla u_0 ,\nabla v\right)\Big)h^{-1} \\
&= \lim_{h\rightarrow 0} \Big(
\left( 2ha'(\|\nabla u_0\|_2^2)\cdot \nabla u_0^T\nabla \varepsilon \nabla u_0,\nabla v\right) \\
&+\left( a\left(\|\nabla u_0 \|_2^2\right) h\nabla \varepsilon,\nabla v\right) 
+\left( 2ha'(\|\nabla u_0\|_2^2)\cdot \nabla u_0^T\nabla \varepsilon \cdot h\nabla\varepsilon,\nabla v\right)\Big)h^{-1} \\
&= 
\left( 2a'(\|\nabla u_0\|_2^2)\cdot \nabla u_0^T\nabla \varepsilon \nabla u_0,\nabla v\right) 
+\left( a\left(\|\nabla u_0 \|_2^2\right) \nabla \varepsilon,\nabla v\right)  \\
\end{align*}
Now using the last line we can write
\begin{align*}
\left( 2a'(\|\nabla u_0\|_2^2)\cdot \nabla u_0^T\nabla \varepsilon \nabla u_0,\nabla v\right) 
+\left( a\left(\|\nabla u_0 \|_2^2\right) \nabla \varepsilon,\nabla v\right)  &= L(v)-G(u_0,v) \\
\left( 2a'(\|\nabla u_0\|_2^2)\cdot \nabla u_0 \nabla u_0^T\nabla \varepsilon,\nabla v\right) 
+\left( a\left(\|\nabla u_0 \|_2^2\right) \nabla \varepsilon,\nabla v\right)  &= L(v)-G(u_0,v) \\
\left( \left(a\left(\|\nabla u_0 \|_2^2\right)\mathbf{I}+2a'(\|\nabla u_0\|_2^2)\cdot \nabla u_0 \nabla u_0^T\right)\nabla \varepsilon,\nabla v\right) &= L(v)-G(u_0,v) \\
\end{align*}
Which can now be solved as a linear FEM problem w.r.t to $\varepsilon$.


\clearpage
%\section*{Appendix A}
%\lstinputlisting{asd.m}

\end{document}              % Päättää dokumentin
